{"version":3,"file":"transformPlatformModule.js","sourceRoot":"","sources":["../../src/ExpoBluetooth/transformPlatformModule.ts"],"names":[],"mappings":"AAAA,OAAO,sBAAsB,MAAM,kCAAkC,CAAC;AACtE,OAAO,gBAAgB,MAAM,4BAA4B,CAAC;AAE1D,MAAM,CAAC,OAAO,UAAU,8BAA8B,CAAC,cAEtD;IACC,MAAM,QAAQ,GAAG,EAAE,CAAC;IACpB,KAAK,MAAM,QAAQ,IAAI,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,EAAE;QAClD,IAAI,OAAO,cAAc,CAAC,QAAQ,CAAC,KAAK,UAAU,EAAE;YAClD,MAAM,CAAC,cAAc,CAAC,QAAQ,EAAE,QAAQ,EAAE;gBACxC,GAAG;oBACD,OAAO,cAAc,CAAC,QAAQ,CAAC,CAAC;gBAClC,CAAC;aACF,CAAC,CAAC;SACJ;aAAM;YACL,QAAQ,CAAC,QAAQ,CAAC,GAAG,0BAA0B,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE,QAAQ,CAAC,CAAC;SACrF;KACF;IACD,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;IACxB,OAAO,QAAQ,CAAC;AAClB,CAAC;AAED,SAAS,0BAA0B,CACjC,MAAyC,EACzC,UAAkB;IAElB,uCAAuC;IACvC,MAAM,KAAK,GAAG,SAAS,CAAC,IAAI,KAAK,EAAE,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC;IACjD,OAAO,KAAK,EAAE,GAAG,KAAY,EAAgB,EAAE;QAC7C,IAAI;YACF,iDAAiD;YACjD,OAAO,MAAM,MAAM,CAAC,GAAG,KAAK,CAAC,CAAC;SAC/B;QAAC,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,KAAK,EAAE,EAAE;YACpC,IAAI,KAAK,CAAC;YACV,IAAI,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,EAAE;gBACtC,MAAM,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC1C,KAAK,GAAG,IAAI,gBAAgB,CAAC;oBAC3B,cAAc,EAAE,QAAQ,CAAC,cAAc,CAAC;oBACxC,KAAK;oBACL,aAAa,EAAE,UAAU;iBAC1B,CAAC,CAAC;aACJ;YACD,KAAK,GAAG,IAAI,sBAAsB,CAAC;gBACjC,OAAO;gBACP,IAAI;gBACJ,GAAG,KAAK;gBACR,aAAa,EAAE,UAAU;gBACzB,KAAK;aACN,CAAC,CAAC;YAEH,eAAe;YACf,MAAM,KAAK,CAAC;SACb;IACH,CAAC,CAAC;AACJ,CAAC","sourcesContent":["import BluetoothPlatformError from '../errors/BluetoothPlatformError';\nimport AndroidGATTError from '../errors/AndroidGATTError';\n\nexport default function platformModuleWithCustomErrors(platformModule: {\n  [property: string]: any;\n}): { [property: string]: any } {\n  const platform = {};\n  for (const property of Object.keys(platformModule)) {\n    if (typeof platformModule[property] !== 'function') {\n      Object.defineProperty(platform, property, {\n        get() {\n          return platformModule[property];\n        },\n      });\n    } else {\n      platform[property] = methodWithTransformedError(platformModule[property], property);\n    }\n  }\n  Object.freeze(platform);\n  return platform;\n}\n\nfunction methodWithTransformedError(\n  method: (...props: any[]) => Promise<any>,\n  methodName: string\n): (...props: any[]) => Promise<any> {\n  /** Stack trace without async layers */\n  const stack = decodeURI(new Error().stack || '');\n  return async (...props: any[]): Promise<any> => {\n    try {\n      // console.log(`EXBLE: invoke: ${methodName}()`);\n      return await method(...props);\n    } catch ({ message, code, ...props }) {\n      let error;\n      if (code.indexOf('ERR_BLE_GATT:') > -1) {\n        const gattStatusCode = code.split(':')[1];\n        error = new AndroidGATTError({\n          gattStatusCode: parseInt(gattStatusCode),\n          stack,\n          invokedMethod: methodName,\n        });\n      }\n      error = new BluetoothPlatformError({\n        message,\n        code,\n        ...props,\n        invokedMethod: methodName,\n        stack,\n      });\n\n      // error.log();\n      throw error;\n    }\n  };\n}\n"]}